# ğŸ› ï¸ OPML Gardener å¼€å‘æŒ‡å—

## ğŸ“‹ ç›®å½•

- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
- [å¼€å‘æµç¨‹](#å¼€å‘æµç¨‹)
- [æ‰©å±•åŠŸèƒ½](#æ‰©å±•åŠŸèƒ½)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

```
å‰ç«¯æ¡†æ¶ï¼šNext.js 14 (App Router)
è¯­è¨€ï¼šTypeScript 5.3
æ ·å¼ï¼šTailwind CSS 3.4
UI ç»„ä»¶ï¼šshadcn/ui
çŠ¶æ€ç®¡ç†ï¼šReact Hooks
XML å¤„ç†ï¼šfast-xml-parser
å›¾æ ‡ï¼šLucide React
```

### è®¾è®¡åŸåˆ™

1. **éšç§ä¼˜å…ˆ**ï¼šæ‰€æœ‰æ•°æ®åœ¨æµè§ˆå™¨æœ¬åœ°å¤„ç†
2. **ç®€æ´ç›´è§‚**ï¼šæ¸…æ™°çš„ UIï¼Œæ˜“äºä½¿ç”¨
3. **ç±»å‹å®‰å…¨**ï¼šå…¨é¢ä½¿ç”¨ TypeScript
4. **å¯ç»´æŠ¤æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£åˆ†ç¦»

### é¡¹ç›®ç»“æ„

```
OPMLGardener/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx           # ä¸»é¡µé¢
â”‚   â””â”€â”€ globals.css        # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/               # shadcn/ui åŸºç¡€ç»„ä»¶
â”‚   â”œâ”€â”€ OpmlUploader.tsx  # æ–‡ä»¶ä¸Šä¼ 
â”‚   â”œâ”€â”€ FeedTable.tsx     # è®¢é˜…æºè¡¨æ ¼
â”‚   â””â”€â”€ FloatingActionBar.tsx # æµ®åŠ¨æ“ä½œæ 
â”‚
â”œâ”€â”€ hooks/                # è‡ªå®šä¹‰ React Hooks
â”‚   â”œâ”€â”€ useOpml.ts        # OPML çŠ¶æ€ç®¡ç†æ ¸å¿ƒ
â”‚   â”œâ”€â”€ useHistory.ts     # æ’¤é”€/é‡åš
â”‚   â””â”€â”€ useKeyboardShortcuts.ts # å¿«æ·é”®
â”‚
â”œâ”€â”€ lib/                  # å·¥å…·å‡½æ•°åº“
â”‚   â”œâ”€â”€ opml-parser.ts    # OPML è§£æå’Œå¯¼å‡º
â”‚   â”œâ”€â”€ json-handler.ts   # JSON å¤„ç†
â”‚   â”œâ”€â”€ rss-validator.ts  # RSS éªŒè¯
â”‚   â”œâ”€â”€ feed-health-checker.ts # Feed å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ xml-escape.ts     # XML è½¬ä¹‰
â”‚   â””â”€â”€ utils.ts          # é€šç”¨å·¥å…·
â”‚
â””â”€â”€ types/                # TypeScript ç±»å‹å®šä¹‰
    â””â”€â”€ index.ts          # æ•°æ®æ¨¡å‹å®šä¹‰
```

---

## ğŸ”§ æ ¸å¿ƒæ¨¡å—

### 1. æ•°æ®æ¨¡å‹ (`types/index.ts`)

```typescript
export type FeedItem = {
  id: string;          // å”¯ä¸€æ ‡è¯†
  title: string;       // è®¢é˜…æºæ ‡é¢˜
  xmlUrl: string;      // RSS è®¢é˜…åœ°å€
  htmlUrl?: string;    // ç½‘ç«™åœ°å€
  category: string;    // åˆ†ç±»åç§°
  isValid?: boolean;   // éªŒè¯çŠ¶æ€
  lastChecked?: Date;  // æœ€åéªŒè¯æ—¶é—´
  lastUpdated?: string; // æœ€åæ›´æ–°æ—¶é—´
  isSelected: boolean; // é€‰ä¸­çŠ¶æ€
};
```

### 2. OPML è§£æå™¨ (`lib/opml-parser.ts`)

#### `parseOpml(xmlContent: string): FeedItem[]`

è§£æ OPML XML å­—ç¬¦ä¸²ï¼Œæå–è®¢é˜…æºã€‚

**æ”¯æŒçš„ OPML ç»“æ„**ï¼š
```xml
<opml version="2.0">
  <body>
    <outline text="åˆ†ç±»å">
      <outline text="æ ‡é¢˜" xmlUrl="..." htmlUrl="..." />
    </outline>
  </body>
</opml>
```

#### `exportOpml(feeds: FeedItem[]): string`

å°† FeedItem æ•°ç»„è½¬æ¢å› OPML XMLã€‚

#### `downloadOpml(content: string, filename: string): void`

è§¦å‘æµè§ˆå™¨ä¸‹è½½ OPML æ–‡ä»¶ã€‚

### 3. çŠ¶æ€ç®¡ç† Hook (`hooks/useOpml.ts`)

`useOpml` æ˜¯åº”ç”¨çš„æ ¸å¿ƒçŠ¶æ€ç®¡ç†å™¨ã€‚

#### æ ¸å¿ƒæ–¹æ³•

| æ–¹æ³• | åŠŸèƒ½ | å‚æ•° | è¿”å›å€¼ |
|------|------|------|--------|
| `importOpml` | å¯¼å…¥ OPML æ–‡ä»¶ | `fileContent: string` | `{ success, count, error? }` |
| `exportFeeds` | å¯¼å‡ºè®¢é˜…æº | - | - |
| `updateFeed` | æ›´æ–°å•ä¸ªè®¢é˜…æº | `id, updates` | `void` |
| `deleteFeed` | åˆ é™¤è®¢é˜…æº | `id: string` | `void` |
| `toggleFeedSelection` | åˆ‡æ¢é€‰ä¸­çŠ¶æ€ | `id: string` | `void` |
| `toggleAllSelection` | å…¨é€‰/å–æ¶ˆå…¨é€‰ | `selected: boolean` | `void` |
| `removeDuplicates` | å»é™¤é‡å¤ | - | `number` |
| `bulkUpdateCategory` | æ‰¹é‡æ›´æ–°åˆ†ç±» | `ids[], category` | `void` |
| `undo` / `redo` | æ’¤é”€/é‡åš | - | `void` |

#### è®¡ç®—å±æ€§

```typescript
// ç­›é€‰åçš„è®¢é˜…æº
const feeds = useMemo(() => { ... }, [allFeeds, searchQuery, selectedCategory, validationFilter]);

// å”¯ä¸€åˆ†ç±»åˆ—è¡¨
const categories = useMemo(() => { ... }, [allFeeds]);

// ç»Ÿè®¡ä¿¡æ¯
const stats: OpmlStats = useMemo(() => { ... }, [allFeeds]);
```

### 4. å†å²ç®¡ç† (`hooks/useHistory.ts`)

æä¾›æ’¤é”€/é‡åšåŠŸèƒ½ï¼š

- ä¿ç•™æœ€è¿‘ 50 æ¬¡æ“ä½œè®°å½•
- è‡ªåŠ¨é™åˆ¶å†å²è®°å½•æ•°é‡
- æ”¯æŒä»»æ„ç±»å‹çš„çŠ¶æ€ç®¡ç†

### 5. RSS éªŒè¯ (`lib/rss-validator.ts`)

```typescript
export async function validateRssUrl(url: string): Promise<{
  isValid: boolean;
  error?: string;
}>
```

éªŒè¯é€»è¾‘ï¼š
1. å°è¯• HEAD è¯·æ±‚ï¼ˆ5ç§’è¶…æ—¶ï¼‰
2. å¤±è´¥åé™çº§åˆ° GET + no-cors
3. æ‰¹é‡å¹¶å‘å¤„ç†ï¼ˆ10ä¸ª/æ‰¹æ¬¡ï¼‰

---

## ğŸ’» å¼€å‘æµç¨‹

### ç¯å¢ƒè¦æ±‚

- Node.js 18.17 æˆ–æ›´é«˜ç‰ˆæœ¬
- npm / yarn / pnpm

### å¼€å‘æ­¥éª¤

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/yourusername/opml-gardener.git
cd opml-gardener

# 2. å®‰è£…ä¾èµ–
npm install

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 4. ä»£ç æ£€æŸ¥
npm run lint

# 5. ç±»å‹æ£€æŸ¥
npx tsc --noEmit

# 6. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

### ä»£ç è§„èŒƒ

#### TypeScript

- æ‰€æœ‰å‡½æ•°å¿…é¡»æœ‰æ˜ç¡®çš„ç±»å‹å®šä¹‰
- ä½¿ç”¨æ¥å£å®šä¹‰ç»„ä»¶ Props
- é¿å…ä½¿ç”¨ `any`ï¼Œå¿…è¦æ—¶ä½¿ç”¨ `unknown`

#### React

- ä¼˜å…ˆä½¿ç”¨å‡½æ•°ç»„ä»¶
- ä½¿ç”¨ Hooks ç®¡ç†çŠ¶æ€
- ç»„ä»¶èŒè´£å•ä¸€
- Props è§£æ„å¹¶æ·»åŠ ç±»å‹

#### æ ·å¼

- ä½¿ç”¨ Tailwind CSS utility classes
- é¿å…å†…è”æ ·å¼
- ä½¿ç”¨ `cn()` å‡½æ•°åˆå¹¶ class

### Git æäº¤è§„èŒƒ

```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»º/å·¥å…·ç›¸å…³
```

---

## ğŸš€ æ‰©å±•åŠŸèƒ½

### 1. æ·»åŠ æ–°çš„å¯¼å‡ºæ ¼å¼

åœ¨ `lib/` æ·»åŠ å¤„ç†å‡½æ•°ï¼Œåœ¨ `hooks/useOpml.ts` æ·»åŠ æ–¹æ³•ï¼Œåœ¨ UI æ·»åŠ æŒ‰é’®ã€‚

### 2. æ·»åŠ æ–°çš„éªŒè¯è§„åˆ™

åœ¨ `lib/rss-validator.ts` æˆ– `lib/feed-health-checker.ts` æ·»åŠ éªŒè¯é€»è¾‘ã€‚

### 3. å®ç°æ›´å¤šå¿«æ·é”®

åœ¨ `hooks/useKeyboardShortcuts.ts` ä¸­æ·»åŠ æ–°çš„å¿«æ·é”®å®šä¹‰ã€‚

### 4. æ·»åŠ æ–°çš„ç»Ÿè®¡ç»´åº¦

åœ¨ `hooks/useOpml.ts` çš„ `stats` è®¡ç®—å±æ€§ä¸­æ·»åŠ æ–°çš„ç»Ÿè®¡æŒ‡æ ‡ã€‚

---

## ğŸŒ éƒ¨ç½²æŒ‡å—

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build
```

è¿™ä¼šåœ¨ `.next` æˆ– `out` ç›®å½•åˆ›å»ºä¼˜åŒ–åçš„ç”Ÿäº§ç‰ˆæœ¬ã€‚

---

## ğŸ“¦ éƒ¨ç½²é€‰é¡¹

### é€‰é¡¹ 1: Vercelï¼ˆæ¨èï¼‰

Vercel æ˜¯ Next.js çš„å®˜æ–¹æ‰˜ç®¡å¹³å°ï¼Œéƒ¨ç½²æœ€ç®€å•ã€‚

**é€šè¿‡ Vercel CLI éƒ¨ç½²ï¼š**

```bash
# 1. å®‰è£… Vercel CLI
npm i -g vercel

# 2. ç™»å½•å¹¶éƒ¨ç½²
vercel
```

**é€šè¿‡ GitHub è‡ªåŠ¨éƒ¨ç½²ï¼š**

1. å°†ä»£ç æ¨é€åˆ° GitHub
2. è®¿é—® [vercel.com](https://vercel.com)
3. å¯¼å…¥æ‚¨çš„ GitHub ä»“åº“
4. Vercel ä¼šè‡ªåŠ¨æ£€æµ‹ Next.js é¡¹ç›®å¹¶éƒ¨ç½²

**ä¼˜ç‚¹**ï¼š
- è‡ªåŠ¨åŒ–éƒ¨ç½²
- å…¨çƒ CDN
- é›¶é…ç½®
- å…è´¹é¢åº¦å……è¶³

---

### é€‰é¡¹ 2: Netlify

```bash
# 1. æ„å»ºé¡¹ç›®
npm run build

# 2. åˆ›å»º netlify.toml é…ç½®æ–‡ä»¶
[build]
  command = "npm run build"
  publish = ".next"

[[plugins]]
  package = "@netlify/plugin-nextjs"

# 3. éƒ¨ç½²
netlify deploy --prod
```

---

### é€‰é¡¹ 3: é™æ€å¯¼å‡º

Next.js å¯ä»¥å¯¼å‡ºä¸ºçº¯é™æ€ HTMLã€‚

**ä¿®æ”¹ `next.config.js`ï¼š**

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',
  images: {
    unoptimized: true,
  },
}

module.exports = nextConfig
```

**æ„å»ºé™æ€æ–‡ä»¶ï¼š**

```bash
npm run build
```

`out` ç›®å½•åŒ…å«æ‰€æœ‰é™æ€æ–‡ä»¶ï¼Œå¯ä»¥éƒ¨ç½²åˆ°ï¼š
- GitHub Pages
- Cloudflare Pages
- AWS S3 + CloudFront
- ä»»ä½•é™æ€æ‰˜ç®¡æœåŠ¡

---

### é€‰é¡¹ 4: è‡ªæ‰˜ç®¡

**ä½¿ç”¨ PM2 ä¿æŒæœåŠ¡è¿è¡Œï¼š**

```bash
# 1. æ„å»ºé¡¹ç›®
npm run build

# 2. å®‰è£… PM2
npm i -g pm2

# 3. å¯åŠ¨æœåŠ¡
pm2 start npm --name "opml-gardener" -- start

# 4. ä¿å­˜é…ç½®
pm2 save

# 5. è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

**é…ç½® Nginx åå‘ä»£ç†ï¼š**

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

---

### é€‰é¡¹ 5: Docker éƒ¨ç½²

**åˆ›å»º `Dockerfile`ï¼š**

```dockerfile
FROM node:20-alpine AS deps
WORKDIR /app
COPY package*.json ./
RUN npm ci

FROM node:20-alpine AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

FROM node:20-alpine AS runner
WORKDIR /app
ENV NODE_ENV production

COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static

EXPOSE 3000
ENV PORT 3000

CMD ["node", "server.js"]
```

**ä¿®æ”¹ `next.config.js` æ·»åŠ  standalone è¾“å‡ºï¼š**

```javascript
const nextConfig = {
  output: 'standalone',
}
```

**æ„å»ºå’Œè¿è¡Œï¼š**

```bash
docker build -t opml-gardener .
docker run -p 3000:3000 opml-gardener
```

---

## âš™ï¸ ç¯å¢ƒå˜é‡

ç”±äº OPML Gardener æ˜¯çº¯å®¢æˆ·ç«¯åº”ç”¨ï¼Œä¸éœ€è¦ä»»ä½•åç«¯ API æˆ–ç¯å¢ƒå˜é‡ã€‚

---

## ğŸ”’ HTTPS é…ç½®

### ä½¿ç”¨ Vercel/Netlify
è‡ªåŠ¨æä¾›å…è´¹çš„ SSL è¯ä¹¦ã€‚

### è‡ªæ‰˜ç®¡ä½¿ç”¨ Let's Encrypt

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¯ç”¨å‹ç¼©**ï¼šNext.js è‡ªåŠ¨å¯ç”¨ gzip å‹ç¼©
2. **CDN åŠ é€Ÿ**ï¼šä½¿ç”¨ Vercel æˆ– Netlify è‡ªåŠ¨è·å¾—å…¨çƒ CDN
3. **ç¼“å­˜ç­–ç•¥**ï¼šé™æ€èµ„æºè‡ªåŠ¨æ·»åŠ ç¼“å­˜å¤´
4. **ä»£ç åˆ†å‰²**ï¼šNext.js è‡ªåŠ¨è¿›è¡Œä»£ç åˆ†å‰²

---

## ğŸ§ª éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

- [ ] è¿è¡Œ `npm run build` ç¡®ä¿æ— æ„å»ºé”™è¯¯
- [ ] æµ‹è¯•ç”Ÿäº§ç‰ˆæœ¬ `npm run start`
- [ ] æ£€æŸ¥æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] ç¡®è®¤å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- [ ] ä½¿ç”¨ç¤ºä¾‹æ–‡ä»¶ `example.opml` æµ‹è¯•
- [ ] ç¡®è®¤å¿«æ·é”®æ­£å¸¸å·¥ä½œ
- [ ] æµ‹è¯•æ·±è‰²æ¨¡å¼

---

## ğŸ†˜ å¸¸è§éƒ¨ç½²é—®é¢˜

### é—®é¢˜ï¼šæ„å»ºå¤±è´¥
**è§£å†³**ï¼š
- æ£€æŸ¥ Node.js ç‰ˆæœ¬ï¼ˆå»ºè®® 18.17+ï¼‰
- åˆ é™¤ `node_modules` å’Œ `.next`ï¼Œé‡æ–°å®‰è£…ä¾èµ–
- æ£€æŸ¥æ˜¯å¦æœ‰ TypeScript é”™è¯¯

### é—®é¢˜ï¼šéƒ¨ç½²åé¡µé¢ç©ºç™½
**è§£å†³**ï¼š
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
- ç¡®è®¤é™æ€èµ„æºè·¯å¾„æ­£ç¡®
- å¦‚ä½¿ç”¨å­è·¯å¾„éƒ¨ç½²ï¼Œé…ç½® `basePath` å’Œ `assetPrefix`

### é—®é¢˜ï¼šæ–‡ä»¶ä¸Šä¼ ä¸å·¥ä½œ
**è§£å†³**ï¼š
- è¿™æ˜¯å®¢æˆ·ç«¯åŠŸèƒ½ï¼Œæ£€æŸ¥æµè§ˆå™¨çš„ File API æ”¯æŒ
- æ£€æŸ¥ HTTPS é…ç½®ï¼ˆæŸäº›æµè§ˆå™¨è¦æ±‚ï¼‰

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Next.js æ–‡æ¡£](https://nextjs.org/docs)
- [Tailwind CSS æ–‡æ¡£](https://tailwindcss.com/docs)
- [shadcn/ui ç»„ä»¶](https://ui.shadcn.com)
- [fast-xml-parser](https://github.com/NaturalIntelligence/fast-xml-parser)
- [OPML è§„èŒƒ](http://opml.org/spec2.opml)

---

**Happy Coding! ğŸ‰**

